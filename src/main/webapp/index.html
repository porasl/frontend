<!DOCTYPE html>
<html lang="en">
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>I N R I K</title>
  <link rel="icon" href="resources/images/inrik_logo3_white.png">
  <link href="/resources/css/bootstrap/5.3/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
  <link href="/resources/css/mainapp.css" rel="stylesheet">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="/resources/js/bootstrap/5.3/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

  <style>
    #topLinksWrapper {
      min-height: 80px;
      padding: 10px 0;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-wrap: wrap;
      gap: 15px;
    }

    .top-link {
      font-weight: 500;
      color: #007bff;
      text-decoration: none;
      transition: color 0.3s ease;
    }

    .top-link:hover {
      color: #0056b3;
      text-decoration: underline;
    }

    .rail-video {
      width: 140px;
      height: auto;
      border-radius: 8px;
      box-shadow: 0px 2px 5px rgba(0,0,0,0.2);
      transition: transform 0.3s ease;
    }

    .rail-video:hover {
      transform: scale(1.05);
      box-shadow: 0px 4px 10px rgba(0,0,0,0.3);
    }
  </style>
</head>

<body>
  <div class="container-fluid">
    <!-- Header -->
    <div class="row top-row align-items-center justify-content-center text-center">
      <div class="col-auto">
        <img src="resources/images/inrik_logo3_white.png" alt="Logo" class="logo">
      </div>

      <!-- Top Links Wrapper -->
      <div class="col" id="topLinksWrapper">
        <!-- Logged out: Top Links -->
        <div id="topLinksSection" class="d-flex align-items-center gap-3">
          <a href="#" data-bs-toggle="modal" data-bs-target="#registerModal" class="top-link">Create Account</a>
          <a href="#" data-bs-toggle="modal" data-bs-target="#forgotModal" class="top-link">Forgot Password</a>
          <a href="#" data-bs-toggle="modal" data-bs-target="#activateModal" class="top-link">Activate Account</a>
        </div>

        <!-- Logged in: Rail Videos -->
        <div id="railVideosSection" class="d-none d-flex align-items-center gap-2 flex-wrap">
          <video id="railVideo1" src="resources/videos/rail1.mp4" controls class="rail-video"></video>
          <video id="railVideo2" src="resources/videos/rail2.mp4" controls class="rail-video"></video>
          <video id="railVideo3" src="resources/videos/rail3.mp4" controls class="rail-video"></video>
        </div>
      </div>

      <!-- Login and User Info -->
      <div class="col-auto">
        <div id="loginSection" class="login-form">
          <form id="loginForm">
            <input name="email" type="text" class="form-control form-control-sm" placeholder="Email" required>
            <input name="password" type="password" class="form-control form-control-sm" placeholder="Password" required>
            <button class="btn btn-sm btn-primary" type="submit">Login</button>
          </form>
        </div>

        <div id="userSection" class="d-none">
          <div class="d-flex align-items-center">
            <span id="userName" class="me-2 fw-bold"></span>
            <img id="logoutIcon" src="resources/images/logout.png" alt="Logout" style="width:24px; height:24px; cursor:pointer;">
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Video Section -->
  <div class="container py-3">
    <div class="row g-3">
      <div class="col-md-4">
        <div class="card video-card">
          <div class="card-body">
            <h6 class="card-title">Featured User Channel</h6>
            <video id="video1" controls class="w-100"></video>
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="card video-card">
          <div class="card-body">
            <h6 class="card-title">Space Exploration</h6>
            <video id="video2" controls class="w-100"></video>
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="card video-card">
          <div class="card-body">
            <h6 class="card-title">Nature Wonders</h6>
            <video id="video3" controls class="w-100"></video>
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="card video-card">
          <div class="card-body">
            <h6 class="card-title">Sports Highlights</h6>
            <video id="video4" controls class="w-100"></video>
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="card video-card">
          <div class="card-body">
            <h6 class="card-title">Adventure Sports</h6>
            <video id="video5" controls class="w-100"></video>
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="card video-card">
          <div class="card-body">
            <h6 class="card-title">Wildlife Exploration</h6>
            <video id="video6" controls class="w-100"></video>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Modals -->
  <!-- Register Modal -->
  <div class="modal fade" id="registerModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Create Account</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body" id="registerModalBody">
          <form id="registerForm">
            <input type="text" class="form-control mb-2" name="firstname" placeholder="First Name" required>
            <input type="text" class="form-control mb-2" name="lastname" placeholder="Last Name" required>
            <input type="password" class="form-control mb-2" name="password" placeholder="Password" required>
            <input type="password" class="form-control mb-2" name="confirmPassword" placeholder="Confirm Password" required>
            <input type="email" class="form-control mb-2" name="email" placeholder="Email" required>
            <input type="text" class="form-control mb-2" name="role" placeholder="USER" required>
            <button type="submit" class="btn btn-primary w-100">Register</button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Forgot Password Modal -->
  <div class="modal fade" id="forgotModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Forgot Password</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <form id="forgotPasswordForm">
            <input type="email" class="form-control mb-2" name="email" placeholder="Enter your email" required>
            <button type="submit" class="btn btn-primary w-100">Reset Password</button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Activate Account Modal -->
  <div class="modal fade" id="activateModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Activate Account</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <form id="activateAccountForm">
            <input type="text" class="form-control mb-2" name="activationCode" placeholder="Enter Activation Code" required>
            <button type="submit" class="btn btn-primary w-100">Activate Account</button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- JavaScript -->
<script>
document.addEventListener("DOMContentLoaded", function () {
  ['forgotModal', 'activateModal'].forEach(id => {
    const modal = document.getElementById(id);
    if (modal) new bootstrap.Modal(modal);
  });

  const registerForm = document.getElementById("registerForm");
  const registerModalBody = document.getElementById("registerModalBody");
  const loginForm = document.getElementById("loginForm");
  const loginSection = document.getElementById("loginSection");
  const userSection = document.getElementById("userSection");
  const userNameSpan = document.getElementById("userName");
  const logoutIcon = document.getElementById("logoutIcon");
  const topLinksSection = document.getElementById("topLinksSection");
  const railVideosSection = document.getElementById("railVideosSection");

  if (registerForm) {
    registerForm.addEventListener("submit", function (event) {
      event.preventDefault();
      const formData = Object.fromEntries(new FormData(registerForm));

      fetch("http://localhost:8082/api/register", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(formData),
      })
      .then(response => {
        if (!response.ok) {
          return response.json().then(data => { throw new Error(data.message || "Registration failed."); });
        }
        return response.json();
      })
      .then(() => {
        registerModalBody.innerHTML = `<div class="alert alert-success text-center"><strong>User is created!</strong> An email has been sent to <strong>${formData.email}</strong> with activation instructions.</div>`;
      })
      .catch(error => {
        console.error("Registration error:", error);
        alert(error.message || "Registration failed. Please try again.");
      });
    });
  }

  function updateUI() {
    const token = localStorage.getItem("token");
    const userName = localStorage.getItem("userName");

    if (token && userName) {
      loginSection.classList.add("d-none");
      userSection.classList.remove("d-none");
      userNameSpan.textContent = userName;
      topLinksSection.classList.add("d-none");
      railVideosSection.classList.remove("d-none");
    } else {
      loginSection.classList.remove("d-none");
      userSection.classList.add("d-none");
      userNameSpan.textContent = "";
      topLinksSection.classList.remove("d-none");
      railVideosSection.classList.add("d-none");
    }
  }

  if (loginForm) {
    loginForm.addEventListener("submit", function (event) {
      event.preventDefault();
      const formData = new FormData(loginForm);
      const email = formData.get("email");
      const password = formData.get("password");

      fetch("http://localhost:8080/auth/authenticate", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ email, password }),
      })
      .then(response => {
        if (!response.ok) {
          throw new Error("Invalid login credentials");
        }
        return response.json();
      })
      .then(data => {
        localStorage.setItem("token", data.access_token);
        localStorage.setItem("refresh_token", data.refresh_token);
        localStorage.setItem("userName", email);
        updateUI();
        window.location.href = "/dashboard";
      })
      .catch(error => {
        console.error("Login failed:", error);
        alert("Login failed. Please check your credentials.");
      });
    });
  }

  if (logoutIcon) {
    logoutIcon.addEventListener("click", function () {
      localStorage.removeItem("token");
      localStorage.removeItem("refresh_token");
      localStorage.removeItem("userName");
      updateUI();
      window.location.href = "/";
    });
  }

  updateUI();
});
</script>
</body>
</html>
