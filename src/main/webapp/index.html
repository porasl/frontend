<!DOCTYPE html>
<html lang="en">
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>I N R I K</title>
  <link rel="icon" href="resources/images/inrik_logo3_white.png">
  <link href="/resources/css/bootstrap/5.3/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
  <link href="/resources/css/mainapp.css" rel="stylesheet">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="/resources/js/bootstrap/5.3/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

  <style>
    html, body {
      font-family: sans-serif;
      margin: 0;
      padding: 0;
      height: 100%;
      overflow: hidden;
    }

    #app-container {
      display: flex;
      height: 100%;
      margin-top: 56px; /* leave space for fixed navbar */
    }

    .leftbar {
      width: 200px;
      background-color: #f5f5f5;
      border-right: 1px solid #ddd;
      padding: 1rem;
      box-shadow: 2px 0 5px rgba(0,0,0,0.05);
      position: fixed;
      top: 56px;
      bottom: 0;
      overflow: hidden;
    }

    .main-content {
      margin-left: 200px;
      padding: 1rem;
      height: calc(100% - 56px);
      overflow-y: auto;
      width: calc(100% - 200px);
    }

    .tabs.navbar {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 1030;
      background-color: white !important;
      color: #007bff;
      border-bottom: 1px solid #ddd;
      border-radius: 0;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      padding: 6px 12px;
    }

    .tabs.navbar li {
      list-style: none;
      margin: 0;
      padding: 0;
    }

    .tabs.navbar a {
      color: #007bff !important;
      text-decoration: none;
      padding: 6px 12px;
      font-weight: 500;
      border-radius: 4px;
    }

    .tabs.navbar a:hover,
    .tabs.navbar a.active {
      background-color: #e6f0ff;
      color: #0056b3 !important;
    }

    .tabs.navbar .logo {
      height: 36px;
      margin-right: 6px;
    }

    .top-link {
      font-weight: 500;
      color: #007bff;
      font-size: 15px;
      text-decoration: none;
      transition: color 0.3s ease;
    }

    .top-link:hover {
      color: #0056b3;
      text-decoration: underline;
    }

    .rail-video {
      width: 140px;
      height: auto;
      border-radius: 8px;
      box-shadow: 0px 2px 5px rgba(0,0,0,0.2);
      transition: transform 0.3s ease;
    }

    .rail-video:hover {
      transform: scale(1.05);
      box-shadow: 0px 4px 10px rgba(0,0,0,0.3);
    }

    @media (max-width: 576px) {
      .tabs.navbar {
        flex-direction: column;
        align-items: flex-start;
      }

      .tabs.navbar .logo {
        align-self: flex-end;
        margin-top: 10px;
      }

      .leftbar {
        display: none;
      }

      .main-content {
        margin-left: 0;
        width: 100%;
      }
    }
    
    @media (max-width: 576px) {
  .tabs.navbar {
    flex-direction: column;
    align-items: flex-start;
  }

  .tabs.navbar .logo {
    align-self: flex-end;
    margin-top: 10px;
  }
}

#railVideosSection {
  display: flex;
  gap: 1rem;
  overflow-x: auto;
  padding-bottom: 10px;
  padding-top: 10px;
  margin-bottom: 1rem;
  scrollbar-width: thin;
  scrollbar-color: #007bff #f1f1f1;
}

#railVideosSection::-webkit-scrollbar {
  height: 8px;
}

#railVideosSection::-webkit-scrollbar-thumb {
  background-color: #007bff;
  border-radius: 4px;
}






    
  </style>
</head>

<body>

  <!-- Navbar -->
  <nav class="tabs navbar d-flex justify-content-between align-items-center flex-wrap w-100">
    <div id="topLinksSection" class="d-flex align-items-center gap-3">
      <li class="nav-item">
        <a class="navbar-brand d-flex" href="index.html">
          <img src="resources/images/inrik_logo3_white.png" alt="Logo" class="logo">
        </a>
      </li>
      <li class="nav-item"><a href="#" data-bs-toggle="modal" data-bs-target="#registerModal" class="top-link">Create Account</a></li>
      <li class="nav-item"><a href="#" data-bs-toggle="modal" data-bs-target="#forgotModal" class="top-link">Forgot Password</a></li>
      <li class="nav-item"><a href="#" data-bs-toggle="modal" data-bs-target="#activateModal" class="top-link">Activate Account</a></li>
    </div>

    <div class="d-flex align-items-center gap-3">
      <div id="loginSection" class="login-form">
        <form id="loginForm">
          <input name="email" type="text" class="form-control form-control-sm" placeholder="Email" required>
          <input name="password" type="password" class="form-control form-control-sm" placeholder="Password" required>
          <button class="btn btn-sm btn-primary" type="submit">Login</button>
        </form>
      </div>
     
    <div id="userSection" class="d-none d-flex align-items-center gap-3">
          <div class="d-flex">
          
          <img src="resources/images/inrik_logo3_white.png" alt="Logo" class="logo" style="height: 40px;" style="align:left" class="me-2">
           
           <li class="nav-item">
          <a href="#" data-bs-toggle="modal" data-bs-target="#myContent" 
               class="top-link">My Contents</a>
        </li>
        <li class="nav-item">
            <a href="#" data-bs-toggle="modal" data-bs-target="#bazaartoday" class="top-link">Bazaar Today</a>
        </li>
        
          <li class="nav-item"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;        </li>
          <li class="nav-item"></li>
          <li class="nav-item"></li>
      
          <li class="nav-item" style="align:right"> 
            <font size=2><span id="userName" class="me-2"></span></font>
          </li>
          
          <li class="nav-item"> 
            <img id="logoutIcon" src="resources/images/logout.png" alt="Logout" style="width:24px; height:24px; cursor:pointer;">
            </li>
           
          </div>
        </div>
      </div>
    </div>
  </nav>

  <!-- App Layout -->
  <div id="app-container">
    <!-- Sidebar -->
    <div class="leftbar">
      <ul class="nav flex-column">
        <li class="nav-item"><a class="nav-link" href=""><img src="resources/images/video.png" width="50px"></a></li>
        <li class="nav-item"><a class="nav-link" href=""><img src="resources/images/upload.png" width="50px"></a></li>
        <li class="nav-item"><a class="nav-link" href="#"><img src="resources/images/memoryNotes.png" width="50px"></a></li>
                <li class="nav-item"><a class="nav-link" href=""><img src="resources/images/profile.png" width="50px"></a></li>

      </ul>
    </div>

 
     <div class="main-content">
  

 
 
  <div id="railVideosSection">
          <video id="railVideo1" src="http://localhost:3000/videos/nika.mp4" controls class="rail-video"></video>
          <video id="railVideo2" src="http://localhost:3000/videos/nika.mp4" controls class="rail-video"></video>
          <video id="railVideo3" src="http://localhost:3000/videos/nika.mp4".mp4" controls class="rail-video"></video>
          <video id="railVideo4" src="http://localhost:3000/videos/nika.mp4" controls class="rail-video"></video>
          <video id="railVideo5" src="http://localhost:3000/videos/nika.mp4" controls class="rail-video"></video>
          <video id="railVideo6" src="http://localhost:3000/videos/nika.mp4".mp4" controls class="rail-video"></video>
         </div>

       

  <!-- Video Section -->
  <div class="row g-4">
    <div class="col-12 col-md-6 col-xl-4">
      <div class="card h-100">
        <div class="card-body">
          <h6 class="card-title">Featured User Channel</h6>
          <video src="http://localhost:3000/videos/robin.mp4" controls class="w-100" style="max-height: 300px;"></video>
        </div>
      </div>
    </div>
    <div class="col-12 col-md-6 col-xl-4">
      <div class="card h-100">
        <div class="card-body">
          <h6 class="card-title">Space Exploration</h6>
          <video src="http://localhost:3000/videos/long2.mp4" controls class="w-100" style="max-height: 300px;"></video>
        </div>
      </div>
    </div>
    <div class="col-12 col-md-6 col-xl-4">
      <div class="card h-100">
        <div class="card-body">
          <h6 class="card-title">Nature Wonders</h6>
          <video src="http://localhost:3000/videos/long1.mp4" controls class="w-100" style="max-height: 300px;"></video>
        </div>
      </div>
    </div>
      <div class="col-md-4">
        <div class="card video-card">
          <div class="card-body">
            <h6 class="card-title">Allie Sherlock & Fabio Rodrigues</h6>
            <video id="video4" src="http://localhost:3000/videos/song1.mp4" controls class="w-100"></video>
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="card video-card">
          <div class="card-body">
            <h6 class="card-title">Space</h6>
            <video id="video5" src="http://localhost:3000/videos/space1.mp4" controls class="w-100"></video>
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="card video-card">
          <div class="card-body">
            <h6 class="card-title">Flowers</h6>
            <video id="video6" src="http://localhost:3000/videos/flowers1.mp4" controls class="w-100"></video>
          </div>
          <!-- Repeat similar video cards for others -->
        </div>
      </div>
    </div>
  </div>


  <!-- Modals -->
  <!-- Register Modal -->
  <div class="modal fade" id="registerModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Create Account</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body" id="registerModalBody">
          <form id="registerForm">
            <input type="text" class="form-control mb-2" name="firstname" placeholder="First Name" required>
            <input type="text" class="form-control mb-2" name="lastname" placeholder="Last Name" required>
            <input type="password" class="form-control mb-2" name="password" placeholder="Password" required>
            <input type="password" class="form-control mb-2" name="confirmPassword" placeholder="Confirm Password" required>
            <input type="email" class="form-control mb-2" name="email" placeholder="Email" required>
            <input type="text" class="form-control mb-2" name="role" placeholder="USER" required>
            <button type="submit" class="btn btn-primary w-100">Register</button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Forgot Password Modal -->
  <div class="modal fade" id="forgotModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Forgot Password</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <form id="forgotPasswordForm">
            <input type="email" class="form-control mb-2" name="email" placeholder="Enter your email" required>
            <button type="submit" class="btn btn-primary w-100">Reset Password</button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Activate Account Modal -->
  <div class="modal fade" id="activateModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Activate Account</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <form id="activateAccountForm">
            <input type="text" class="form-control mb-2" name="activationCode" placeholder="Enter Activation Code" required>
            <button type="submit" class="btn btn-primary w-100">Activate Account</button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- JavaScript -->
<script>
document.addEventListener("DOMContentLoaded", function () {
  ['forgotModal', 'activateModal'].forEach(id => {
    const modal = document.getElementById(id);
    if (modal) new bootstrap.Modal(modal);
  });

  const registerForm = document.getElementById("registerForm");
  const registerModalBody = document.getElementById("registerModalBody");
  const loginForm = document.getElementById("loginForm");
  const loginSection = document.getElementById("loginSection");
  const userSection = document.getElementById("userSection");
  const userNameSpan = document.getElementById("userName");
  const logoutIcon = document.getElementById("logoutIcon");
  const topLinksSection = document.getElementById("topLinksSection");
  const railVideosSection = document.getElementById("railVideosSection");

  if (registerForm) {
    registerForm.addEventListener("submit", function (event) {
      event.preventDefault();
      const formData = Object.fromEntries(new FormData(registerForm));

      fetch("http://localhost:8082/api/register", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(formData),
      })
      .then(response => {
        if (!response.ok) {
          return response.json().then(data => { throw new Error(data.message || "Registration failed."); });
        }
        return response.json();
      })
      .then(() => {
        registerModalBody.innerHTML = `<div class="alert alert-success text-center"><strong>User is created!</strong> An email has been sent to <strong>${formData.email}</strong> with activation instructions.</div>`;
      })
      .catch(error => {
        console.error("Registration error:", error);
        alert(error.message || "Registration failed. Please try again.");
      });
    });
  }

  function updateUI() {
    const token = localStorage.getItem("token");
    const userName = localStorage.getItem("userName");

    if (token && userName) {
      loginSection.classList.add("d-none");
      userSection.classList.remove("d-none");
      userNameSpan.textContent = userName;
      topLinksSection.classList.add("d-none");
      railVideosSection.classList.remove("d-none");
    } else {
      loginSection.classList.remove("d-none");
      userSection.classList.add("d-none");
      userNameSpan.textContent = "";
      topLinksSection.classList.remove("d-none");
      railVideosSection.classList.add("d-none");
    }
  }

  if (loginForm) {
    loginForm.addEventListener("submit", function (event) {
      event.preventDefault();
      const formData = new FormData(loginForm);
      const email = formData.get("email");
      const password = formData.get("password");

      fetch("http://localhost:8080/auth/authenticate", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ email, password }),
      })
      .then(response => {
        if (!response.ok) {
          throw new Error("Invalid login credentials");
        }
        return response.json();
      })
      .then(data => {
        localStorage.setItem("token", data.access_token);
        localStorage.setItem("refresh_token", data.refresh_token);
        localStorage.setItem("userName", email);
        updateUI();
        window.location.href = "/dashboard";
      })
      .catch(error => {
        console.error("Login failed:", error);
        alert("Login failed. Please check your credentials.");
      });
    });
  }

  if (logoutIcon) {
    logoutIcon.addEventListener("click", function () {
      localStorage.removeItem("token");
      localStorage.removeItem("refresh_token");
      localStorage.removeItem("userName");
      updateUI();
      window.location.href = "/";
    });
  }

  updateUI();
});

document.addEventListener('DOMContentLoaded', function () {
    const track = document.getElementById('railVideosSection');
    const prevBtn = document.getElementById('rail-prev');
    const nextBtn = document.getElementById('rail-next');

    const getScrollAmount = () => {
      const video = track.querySelector('.rail-video');
      return video.offsetWidth + 16; // 16px = margin-right
    };

    nextBtn.addEventListener('click', () => {
      track.scrollBy({ left: getScrollAmount(), behavior: 'smooth' });
    });

    prevBtn.addEventListener('click', () => {
      track.scrollBy({ left: -getScrollAmount(), behavior: 'smooth' });
    });
  });


</script>
</body>
</html>
