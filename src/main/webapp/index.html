<!DOCTYPE html>
<html lang="en">
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>I N R I K</title>
<link rel="icon" href="resources/images/inrik_logo3_white.png">
<link href="/resources/css/bootstrap/5.3/bootstrap.min.css"
	rel="stylesheet">
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css"
	rel="stylesheet">
<link href="/resources/css/inrik.css" rel="stylesheet">
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="/resources/js/bootstrap/5.3/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

<style>
#uploadSpinnerOverlay {
	position: absolute;
	top: 500;
	left: 500;
	z-index: 1055;
	width: 100%;
	height: 100%;
	background-color: rgba(255, 255, 255, 0.6);
	display: none;
	justify-content: center;
	align-items: center;
}
</style>
</head>

<body>
	<nav
		class="tabs navbar d-flex justify-content-between align-items-center flex-wrap w-100">
		<div id="topLinksSection" class="d-flex align-items-center gap-3">
			<li class="nav-item"><a class="navbar-brand d-flex"
				href="index.html"> <img
					src="resources/images/inrik_logo3_white.png" alt="Logo"
					class="logo">
			</a></li>
			<li class="nav-item"><a href="#" data-bs-toggle="modal"
				data-bs-target="#registerModal" class="top-link">Create Account</a></li>
			<li class="nav-item"><a href="#" data-bs-toggle="modal"
				data-bs-target="#forgotModal" class="top-link">Forgot Password</a></li>
			<li class="nav-item"><a href="#" data-bs-toggle="modal"
				data-bs-target="#activateModal" class="top-link">Activate
					Account</a></li>
		</div>

		<div class="d-flex align-items-center gap-3">
			<div id="loginSection" class="login-form">
				<form id="loginForm">
					<input name="email" type="text"
						class="form-control form-control-sm" placeholder="Email" required>
					<input name="password" type="password"
						class="form-control form-control-sm" placeholder="Password"
						required>
					<button class="btn btn-sm btn-primary" type="submit">Login</button>
				</form>
			</div>

			<div id="userSection"
				class="d-none d-flex justify-content-between align-items-center w-100 px-3">
				<!-- Left-aligned section -->
				<div class="d-flex align-items-center gap-3">
					<li><img src="resources/images/inrik_logo3_white.png"
						alt="Logo" class="logo me-2" style="height: 40px;"></li>
					<li class="nav-item"><img src="resources/images/myContent.png"
						alt="My Contents" onclick="showMyContent()" class="me-2"
						style="height: 40px;"></li>
					<li class="nav-item"><img src="resources/images/add.png"
						alt="Add" class="me-2" style="height: 40px; cursor: pointer;"
						data-bs-toggle="modal" data-bs-target="#uploadModal"></li>
					<li class="nav-item"><a href="#" class="top-link"
						onclick="showBazaar()">Bazaar Today</a></li>
				</div>

				<!-- Right-aligned user info section -->
				<div class="d-flex align-items-center gap-2">
					<li class="nav-item"><font size="2"><span id="userName"
							class="me-2"></span></font></li>
					<li class="nav-item"><img id="logoutIcon"
						src="resources/images/logout.png" alt="Logout"
						style="width: 24px; height: 24px; cursor: pointer;"></li>
				</div>
			</div>

		</div>
	</nav>

	<div id="myContents-container" class="d-none"
		style="padding: 100px; padding-left: 150px">
		<h2>Welcome to My Contents</h2>
		<p>Here is your custom content area.</p>
	</div>


	<div id="iframe-container" class="d-none">
		<iframe src="https://bazaartoday.com" width="100%" height="1000px"
			frameborder="0" style="border: none;"></iframe>
	</div>

	<div class="leftbar">
		<ul class="nav flex-column">
			<li class="nav-item"></li>
			<br>
			<li class="nav-item"><a class="nav-link" href=""><img
					src="resources/images/home.png" width="40px"></a></li>
			<li class="nav-item"><a class="nav-link" href=""><img
					src="resources/images/video.png" width="40px"></a></li>
			<li class="nav-item"><a class="nav-link" href=""><img
					src="resources/images/cut.png" width="60px"></a></li>
			<li class="nav-item"><a class="nav-link" href=""><img
					src="resources/images/music.png" width="40px"></a></li>
			<li class="nav-item"><a class="nav-link" href="#"
				data-bs-toggle="modal" data-bs-target="#uploadModal"> <img
					src="resources/images/upload.png" width="40px">
			</a></li>
			<li class="nav-item"><a class="nav-link" href=""><img
					src="resources/images/photo.png" width="40px"></a></li>
			<li class="nav-item"><a class="nav-link" href="#"><img
					src="resources/images/memoryNotes.png" width="40px"></a></li>
			<li class="nav-item"><a class="nav-link" href=""><img
					src="resources/images/profile.png" width="40px"></a></li>
		</ul>
	</div>

	<div id="app-container">
		<div class="main-content">

			<div id="railVideosSection">
				<div class="video-scroll-wrapper">
					<button class="scroll-btn" id="scroll-prev">&#9664;</button>
					<div class="video-scroll-track" id="videoScrollTrack">
						<video id="railVideo1" src="http://localhost:3000/videos/nika.mp4"
							controls class="scroll-video"></video>
						<video id="railVideo2" src="http://localhost:3000/videos/nika.mp4"
							controls class="scroll-video"></video>
						<video id="railVideo3" src="http://localhost:3000/videos/nika.mp4"
							controls class="scroll-video"></video>
						<video id="railVideo4" src="http://localhost:3000/videos/nika.mp4"
							controls class="scroll-video"></video>
						<video id="railVideo5" src="http://localhost:3000/videos/nika.mp4"
							controls class="scroll-video"></video>
						<video id="railVideo6" src="http://localhost:3000/videos/nika.mp4"
							controls class="scroll-video"></video>
						<video id="railVideo7" src="http://localhost:3000/videos/nika.mp4"
							controls class="scroll-video"></video>
						<video id="railVideo8" src="http://localhost:3000/videos/nika.mp4"
							controls class="scroll-video"></video>
						<video id="railVideo9" src="http://localhost:3000/videos/nika.mp4"
							controls class="scroll-video"></video>
						<video id="railVideo10"
							src="http://localhost:3000/videos/nika.mp4" controls
							class="scroll-video"></video>
						<video id="railVideo11"
							src="http://localhost:3000/videos/nika.mp4" controls
							class="scroll-video"></video>
						<video id="railVideo12"
							src="http://localhost:3000/videos/nika.mp4" controls
							class="scroll-video"></video>
					</div>
					<button class="scroll-btn" id="scroll-next">&#9654;</button>
				</div>
			</div>

			<!-- Video Section -->
			<div class="row g-4">
				<div class="col-12 col-md-6 col-xl-4">
					<div class="card h-100">
						<div class="card-body">
							<h6 class="card-title">Featured User Channel</h6>
							<video src="http://localhost:3000/videos/robin.mp4" controls
								class="w-100" style="max-height: 300px;"></video>
						</div>
					</div>
				</div>
				<div class="col-12 col-md-6 col-xl-4">
					<div class="card h-100">
						<div class="card-body">
							<h6 class="card-title">Space Exploration</h6>
							<video src="http://localhost:3000/videos/long2.mp4" controls
								class="w-100" style="max-height: 300px;"></video>
						</div>
					</div>
				</div>
				<div class="col-12 col-md-6 col-xl-4">
					<div class="card h-100">
						<div class="card-body">
							<h6 class="card-title">Nature Wonders</h6>
							<video src="http://localhost:3000/videos/long1.mp4" controls
								class="w-100" style="max-height: 300px;"></video>
						</div>
					</div>
				</div>
				<div class="col-md-4">
					<div class="card video-card">
						<div class="card-body">
							<h6 class="card-title">Allie Sherlock & Fabio Rodrigues</h6>
							<video id="video4" src="http://localhost:3000/videos/song1.mp4"
								controls class="w-100"></video>
						</div>
					</div>
				</div>
				<div class="col-md-4">
					<div class="card video-card">
						<div class="card-body">
							<h6 class="card-title">Space</h6>
							<video id="video5" src="http://localhost:3000/videos/space1.mp4"
								controls class="w-100"></video>
						</div>
					</div>
				</div>
				<div class="col-md-4">
					<div class="card video-card">
						<div class="card-body">
							<h6 class="card-title">Flowers</h6>
							<video id="video6"
								src="http://localhost:3000/videos/flowers1.mp4" controls
								class="w-100"></video>
						</div>
						<!-- Repeat similar video cards for others -->
					</div>
				</div>
			</div>
		</div>

		<!-- Modals -->
		<!-- Register Modal -->
		<div class="modal fade" id="registerModal" tabindex="-1">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title">Create Account</h5>
						<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
					</div>
					<div class="modal-body" id="registerModalBody">
						<form id="registerForm">
							<input type="text" class="form-control mb-2" name="firstname"
								placeholder="First Name" required> <input type="text"
								class="form-control mb-2" name="lastname"
								placeholder="Last Name" required> <input type="password"
								class="form-control mb-2" name="password" placeholder="Password"
								required> <input type="password"
								class="form-control mb-2" name="confirmPassword"
								placeholder="Confirm Password" required> <input
								type="email" class="form-control mb-2" name="email"
								placeholder="Email" required> <input type="text"
								class="form-control mb-2" name="role" placeholder="USER"
								required>
							<button type="submit" class="btn btn-primary w-100">Register</button>
						</form>
					</div>
				</div>
			</div>
		</div>

		<!-- Forgot Password Modal -->
		<div class="modal fade" id="forgotModal" tabindex="-1">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title">Forgot Password</h5>
						<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
					</div>
					<div class="modal-body">
						<form id="forgotPasswordForm">
							<input type="email" class="form-control mb-2" name="email"
								placeholder="Enter your email" required>
							<button type="submit" class="btn btn-primary w-100">Reset
								Password</button>
						</form>
					</div>
				</div>
			</div>
		</div>

		<!-- Activate Account Modal -->
		<div class="modal fade" id="activateModal" tabindex="-1">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title">Activate Account</h5>
						<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
					</div>
					<div class="modal-body">
						<form id="activateAccountForm">
							<input type="text" class="form-control mb-2"
								name="activationCode" placeholder="Enter Activation Code"
								required>
							<button type="submit" class="btn btn-primary w-100">Activate
								Account</button>
						</form>
					</div>
				</div>
			</div>
		</div>

		<div id="uploadSpinnerOverlay">
			<div class="spinner-border text-primary" role="status"
				style="width: 3rem; height: 3rem;">
				<span class="visually-hidden">Uploading...</span>
			</div>
		</div>

		<!-- Upload Modal -->
		<div class="modal fade" id="uploadModal" tabindex="-1">
			<div class="modal-dialog modal-lg">
				<div class="modal-content">
					<form id="uploadForm" enctype="multipart/form-data">
						<div class="modal-header">
							<h5 class="modal-title">Upload Content</h5>
							<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
						</div>
						<div class="modal-body">
							<!-- Title -->
							<div class="mb-3">
								<label for="title" class="form-label">Title</label> <input
									type="text" class="form-control" id="title" name="title"
									required>
							</div>

							<!-- Description -->
							<div class="mb-3">
								<label for="description" class="form-label">Description</label>
								<textarea class="form-control" id="description"
									name="description" rows="2"></textarea>
							</div>

							<!-- Categories -->
							<div class="mb-3">
								<label class="form-label d-block mb-1">Categories</label>
								<div class="d-flex flex-wrap gap-3" id="categoryGroup">
									<div class="form-check">
										<input class="form-check-input" type="checkbox"
											name="category" value="event" id="catEvent"><label
											class="form-check-label" for="catEvent">Event</label>
									</div>
									<div class="form-check">
										<input class="form-check-input" type="checkbox"
											name="category" value="memory" id="catMemory"><label
											class="form-check-label" for="catMemory">Memory</label>
									</div>
									<div class="form-check">
										<input class="form-check-input" type="checkbox"
											name="category" value="status" id="catStatus" checked><label
											class="form-check-label" for="catStatus">Status</label>
									</div>
									<div class="form-check">
										<input class="form-check-input" type="checkbox"
											name="category" value="news" id="catNews"><label
											class="form-check-label" for="catNews">News</label>
									</div>
									<div class="form-check">
										<input class="form-check-input" type="checkbox"
											name="category" value="priority" id="catPriority"><label
											class="form-check-label" for="catPriority">Priority</label>
									</div>
									<div class="form-check">
										<input class="form-check-input" type="checkbox"
											name="category" value="sport" id="catSport"><label
											class="form-check-label" for="catSport">Sport</label>
									</div>
									<div class="form-check">
										<input class="form-check-input" type="checkbox"
											name="category" value="game" id="catGame"><label
											class="form-check-label" for="catGame">Game</label>
									</div>
									<div class="form-check">
										<input class="form-check-input" type="checkbox"
											name="category" value="food" id="catFood"><label
											class="form-check-label" for="catFood">Food</label>
									</div>
									<div class="form-check">
										<input class="form-check-input" type="checkbox"
											name="category" value="women" id="catWomen"><label
											class="form-check-label" for="catWomen">Women</label>
									</div>
									<div class="form-check">
										<input class="form-check-input" type="checkbox"
											name="category" value="men" id="catMen"><label
											class="form-check-label" for="catMen">Men</label>
									</div>
									<div class="form-check">
										<input class="form-check-input" type="checkbox"
											name="category" value="kids" id="catKids"><label
											class="form-check-label" for="catKids">Kids</label>
									</div>
								</div>
							</div>

							<!-- File Drop Zone -->
							<div
								class="mb-3 border border-secondary rounded p-4 text-center position-relative"
								id="dropZone" style="background-color: #f8f9fa; height: 250px;">
								<p class="mb-2">Drop your file here or click to browse</p>
								<input type="file" id="fileInput" name="file" required
									style="opacity: 0; position: absolute; top: 0; left: 0; width: 100%; height: 100%; cursor: pointer;">
								<button type="button"
									class="btn btn-outline-secondary position-absolute top-50 start-50 translate-middle"
									onclick="document.getElementById('fileInput').click();">Browse</button>
								<p id="fileName" class="mt-2 text-muted"></p>
								<p class="text-muted mt-3">Max file size: 100 MB</p>
							</div>
						</div>

						<div class="modal-footer">
							<button type="submit" class="btn btn-primary">Upload</button>
							<button type="button" class="btn btn-secondary"
								data-bs-dismiss="modal">Cancel</button>
						</div>
						<div class="text-center p-3">
							<div class="spinner-border text-primary d-none" role="status"
								id="uploadSpinner">
								<span class="visually-hidden">Uploading...</span>
							</div>
						</div>
					</form>
				</div>
			</div>
		</div>



		<!-- JavaScript -->
		<script>
document.addEventListener("DOMContentLoaded", function () {
  ['forgotModal', 'activateModal'].forEach(id => {
    const modal = document.getElementById(id);
    if (modal) new bootstrap.Modal(modal);
  });

  const registerForm = document.getElementById("registerForm");
  const registerModalBody = document.getElementById("registerModalBody");
  const loginForm = document.getElementById("loginForm");
  const loginSection = document.getElementById("loginSection");
  const userSection = document.getElementById("userSection");
  const userNameSpan = document.getElementById("userName");
  const logoutIcon = document.getElementById("logoutIcon");
  const topLinksSection = document.getElementById("topLinksSection");
  const railVideosSection = document.getElementById("railVideosSection");

  if (registerForm) {
    registerForm.addEventListener("submit", function (event) {
      event.preventDefault();
      const formData = Object.fromEntries(new FormData(registerForm));

      fetch("http://localhost:8082/api/register", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(formData),
      })
      .then(response => {
        if (!response.ok) {
          return response.json().then(data => { throw new Error(data.message || "Registration failed."); });
        }
        return response.json();
      })
      .then(() => {
        registerModalBody.innerHTML = `<div class="alert alert-success text-center"><strong>User is created!</strong> An email has been sent to <strong>${formData.email}</strong> with activation instructions.</div>`;
      })
      .catch(error => {
        console.error("Registration error:", error);
        alert(error.message || "Registration failed. Please try again.");
      });
    });
  }

  function updateUI() {
    const token = localStorage.getItem("token");
    const userName = localStorage.getItem("userName");

    if (token && userName) {
      loginSection.classList.add("d-none");
      userSection.classList.remove("d-none");
      userNameSpan.textContent = userName;
      topLinksSection.classList.add("d-none");
      railVideosSection.classList.remove("d-none");
    } else {
      loginSection.classList.remove("d-none");
      userSection.classList.add("d-none");
      userNameSpan.textContent = "";
      topLinksSection.classList.remove("d-none");
      railVideosSection.classList.add("d-none");
    }
  }

  if (loginForm) {
    loginForm.addEventListener("submit", function (event) {
      event.preventDefault();
      const formData = new FormData(loginForm);
      const email = formData.get("email");
      const password = formData.get("password");

      fetch("http://localhost:8080/auth/authenticate", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ email, password }),
      })
      .then(response => {
        if (!response.ok) {
          throw new Error("Invalid login credentials");
        }
        return response.json();
      })
      .then(data => {
        localStorage.setItem("token", data.access_token);
        localStorage.setItem("refresh_token", data.refresh_token);
        localStorage.setItem("userName", email);
        updateUI();
        window.location.href = "/dashboard";
      })
      .catch(error => {
        console.error("Login failed:", error);
        alert("Login failed. Please check your credentials.");
      });
    });
  }

  if (logoutIcon) {
    logoutIcon.addEventListener("click", function () {
      localStorage.removeItem("token");
      localStorage.removeItem("refresh_token");
      localStorage.removeItem("userName");
      updateUI();
      window.location.href = "/";
    });
  }

  updateUI();
});

function showBazaar() {
	  document.getElementById("iframe-container").classList.remove("d-none");
	  document.getElementById("app-container").classList.add("d-none");
	  document.getElementById("myContents-container").classList.add("d-none");
	}

	function showApp() {
	  document.getElementById("iframe-container").classList.add("d-none");
	  document.getElementById("app-container").classList.remove("d-none");
	  document.getElementById("myContents-container").classList.add("d-none");
	}

	function showMyContent() { console.log("ðŸ” showMyContent called");
	  document.getElementById("myContents-container").classList.remove("d-none");
	  document.getElementById("iframe-container").classList.add("d-none");
	  document.getElementById("app-container").classList.add("d-none");
	}

	document.addEventListener("DOMContentLoaded", function () {
		  const scrollTrack = document.getElementById("videoScrollTrack");
		  const prevBtn = document.getElementById("scroll-prev");
		  const nextBtn = document.getElementById("scroll-next");

		  const scrollAmount = () => {
		    const video = scrollTrack.querySelector(".scroll-video");
		    return video.offsetWidth + 10; // gap is 10px
		  };

		  nextBtn.addEventListener("click", () => {
		    scrollTrack.scrollBy({ left: scrollAmount(), behavior: 'smooth' });
		  });

		  prevBtn.addEventListener("click", () => {
		    scrollTrack.scrollBy({ left: -scrollAmount(), behavior: 'smooth' });
		  });
		});

    //Upload Modal
    
document.addEventListener("DOMContentLoaded", function () {
  const dropZone = document.getElementById("dropZone");
  const fileInput = document.getElementById("fileInput");
  const fileNameDisplay = document.getElementById("fileName");
  const uploadForm = document.getElementById("uploadForm");

  const MAX_SIZE_MB = 100;
  
  //listeners for the upload checkBoxes
  const categoryGroup = document.getElementById("categoryGroup");
  const checkboxes = categoryGroup.querySelectorAll('input[type="checkbox"]');


  // Drag-and-drop handlers
  dropZone.addEventListener("dragover", (e) => {
    e.preventDefault();
    dropZone.classList.add("bg-light");
  });

  dropZone.addEventListener("dragleave", () => {
    dropZone.classList.remove("bg-light");
  });

  dropZone.addEventListener("drop", (e) => {
    e.preventDefault();
    dropZone.classList.remove("bg-light");
    const file = e.dataTransfer.files[0];
    if (file) handleFileSelect(file);
  });

  fileInput.addEventListener("change", (e) => {
    const file = e.target.files[0];
    if (file) handleFileSelect(file);
  });

  function handleFileSelect(file) {
    const maxBytes = MAX_SIZE_MB * 1024 * 1024;
    if (file.size > maxBytes) {
      alert("File exceeds the 100MB size limit.");
      fileInput.value = "";
      fileNameDisplay.textContent = "";
      return;
    }
    const dt = new DataTransfer();
    dt.items.add(file);
    fileInput.files = dt.files;
    fileNameDisplay.textContent = file.name;
  }

  $(document).ready(function () {
	  $('#uploadForm').on('submit', function (e) {
	    e.preventDefault();

	    var formData = new FormData(this);
	    var spinnerOverlay = $('#uploadSpinnerOverlay');

	    // Show centered spinner overlay
	    spinnerOverlay.show();

	    $.ajax({
	      url: 'http://localhost:8082/api/upload',
	      type: 'POST',
	      data: formData,
	      processData: false,
	      contentType: false,
	      xhr: function () {
	        var xhr = new window.XMLHttpRequest();
	        xhr.upload.addEventListener('progress', function (e) {
	          if (e.lengthComputable) {
	            var percent = Math.round((e.loaded / e.total) * 100);
	            console.log(percent + '%');
	          }
	        });
	        return xhr;
	      },
	      success: function (response) {
	        spinnerOverlay.hide();
	        $('#uploadModal').modal('hide');

	        setTimeout(() => {
	          alert('File uploaded successfully! It will be processed shortly.');
	        }, 500); // Slight delay after modal closes
	      },
	      error: function (xhr, status, error) {
	        spinnerOverlay.hide();
	        alert('Upload failed: ' + error);
	      }
	    });
	  });
	});

  
  
  
});

   
</script>
</body>
</html>
